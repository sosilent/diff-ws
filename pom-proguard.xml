<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>misscut.ijiaodui.com</groupId>
    <artifactId>csm-check</artifactId>
    <version>0.0.1</version>

    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>

        <java.version>17</java.version>
        <vertx.version>4.5.11</vertx.version>
        <micrometer.version>1.13.2</micrometer.version>
        <log4j.version>2.17.1</log4j.version>
        <softdog.version>0.0.4</softdog.version>
        <utils.version>1.2.4</utils.version>

        <main.verticle>com.ijiaodui.diff.Entry</main.verticle>
        <app.version>${project.version}</app.version>
        <!--suppress UnresolvedMavenProperty -->
        <timestamp>${build.time}</timestamp>
        <maven.compiler.source>${java.version}</maven.compiler.source>
        <maven.compiler.target>${java.version}</maven.compiler.target>
    </properties>

    <repositories>
        <repository>
            <id>nexus</id>
            <name>HCI Repository</name>
            <url>https://www.ijiaodui.com/nexus/repository/hci-maven/</url>
            <releases>
                <enabled>true</enabled>
            </releases>
            <snapshots>
                <enabled>true</enabled>
            </snapshots>
        </repository>
    </repositories>

    <dependencies>
        <dependency>
            <groupId>io.vertx</groupId>
            <artifactId>vertx-core</artifactId>
            <version>${vertx.version}</version>
        </dependency>
        <dependency>
            <groupId>io.vertx</groupId>
            <artifactId>vertx-web-api-contract</artifactId>
            <version>${vertx.version}</version>
        </dependency>
        <dependency>
            <groupId>io.vertx</groupId>
            <artifactId>vertx-web</artifactId>
            <version>${vertx.version}</version>
        </dependency>
        <dependency>
            <groupId>io.vertx</groupId>
            <artifactId>vertx-unit</artifactId>
            <version>${vertx.version}</version>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>io.vertx</groupId>
            <artifactId>vertx-web-client</artifactId>
            <version>${vertx.version}</version>
        </dependency>
        <dependency>
            <groupId>io.vertx</groupId>
            <artifactId>vertx-jdbc-client</artifactId>
            <version>${vertx.version}</version>
        </dependency>
        <dependency>
            <groupId>io.vertx</groupId>
            <artifactId>vertx-micrometer-metrics</artifactId>
            <version>${vertx.version}</version>
        </dependency>
        <!-- https://mvnrepository.com/artifact/io.vertx/vertx-config-yaml -->
        <dependency>
            <groupId>io.vertx</groupId>
            <artifactId>vertx-config-yaml</artifactId>
            <version>${vertx.version}</version>
        </dependency>
        <dependency>
            <groupId>io.vertx</groupId>
            <artifactId>vertx-redis-client</artifactId>
            <version>${vertx.version}</version>
        </dependency>
        <dependency>
            <groupId>io.vertx</groupId>
            <artifactId>vertx-hazelcast</artifactId>
            <version>${vertx.version}</version>
        </dependency>
        <dependency>
            <groupId>io.micrometer</groupId>
            <artifactId>micrometer-registry-influx</artifactId>
            <version>${micrometer.version}</version>
        </dependency>
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.13.1</version>
        </dependency>
        <dependency>
            <groupId>org.apache.logging.log4j</groupId>
            <artifactId>log4j-api</artifactId>
            <version>${log4j.version}</version>
        </dependency>
        <dependency>
            <groupId>org.apache.logging.log4j</groupId>
            <artifactId>log4j-core</artifactId>
            <version>${log4j.version}</version>
        </dependency>
        <dependency>
            <groupId>org.apache.logging.log4j</groupId>
            <artifactId>log4j-slf4j-impl</artifactId>
            <version>${log4j.version}</version>
        </dependency>
        <dependency>
            <groupId>org.apache.logging.log4j</groupId>
            <artifactId>log4j-jcl</artifactId>
            <version>${log4j.version}</version>
        </dependency>
        <dependency>
            <groupId>org.apache.logging.log4j</groupId>
            <artifactId>log4j-jul</artifactId>
            <version>${log4j.version}</version>
        </dependency>
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>8.0.26</version>
        </dependency>
        <!-- https://mvnrepository.com/artifact/commons-cli/commons-cli -->
        <dependency>
            <groupId>commons-cli</groupId>
            <artifactId>commons-cli</artifactId>
            <version>1.5.0</version>
        </dependency>
        <!-- https://mvnrepository.com/artifact/javax.persistence/persistence-api -->
        <dependency>
            <groupId>javax.persistence</groupId>
            <artifactId>persistence-api</artifactId>
            <version>1.0.2</version>
        </dependency>
        <!-- https://mvnrepository.com/artifact/org.apache.poi/poi -->
        <dependency>
            <groupId>org.apache.poi</groupId>
            <artifactId>poi</artifactId>
            <version>4.1.1</version>
        </dependency>
        <dependency>
            <groupId>org.apache.httpcomponents</groupId>
            <artifactId>httpclient</artifactId>
            <version>4.5.14</version>
        </dependency>
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <version>1.18.30</version>
            <scope>compile</scope>
        </dependency>
        <!-- https://mvnrepository.com/artifact/org.jetbrains/annotations -->
        <dependency>
            <groupId>org.jetbrains</groupId>
            <artifactId>annotations</artifactId>
            <version>24.0.1</version>
        </dependency>
        <dependency>
            <groupId>org.yaml</groupId>
            <artifactId>snakeyaml</artifactId>
            <version>2.0</version>
        </dependency>
        <!-- https://mvnrepository.com/artifact/net.sf.proguard/proguard-base -->
        <dependency>
            <groupId>net.sf.proguard</groupId>
            <artifactId>proguard-base</artifactId>
            <version>6.2.2</version>
        </dependency>
        <dependency>
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-exec</artifactId>
            <version>1.3</version>
        </dependency>
        <dependency>
            <groupId>com.alibaba.otter</groupId>
            <artifactId>canal.client</artifactId>
            <version>1.1.4</version>
        </dependency>
        <!-- https://mvnrepository.com/artifact/dom4j/dom4j -->
        <dependency>
            <groupId>dom4j</groupId>
            <artifactId>dom4j</artifactId>
            <version>1.6.1</version>
        </dependency>
        <dependency>
            <groupId>app.hci</groupId>
            <artifactId>hci-utils</artifactId>
            <version>${utils.version}</version>
        </dependency>
        <dependency>
            <groupId>app.hci</groupId>
            <artifactId>hci-softdog</artifactId>
            <version>0.0.4</version>
        </dependency>
        <!-- Apache Commons Text -->
        <dependency>
            <groupId>org.apache.commons</groupId>
            <artifactId>commons-text</artifactId>
            <version>1.9</version>
        </dependency>
        <!-- https://mvnrepository.com/artifact/com.hankcs/hanlp -->
        <dependency>
            <groupId>com.hankcs</groupId>
            <artifactId>hanlp</artifactId>
            <version>portable-1.8.5</version>
        </dependency>
        <!-- https://mvnrepository.com/artifact/com.alibaba.nacos/nacos-client -->
        <dependency>
            <groupId>com.alibaba.nacos</groupId>
            <artifactId>nacos-client</artifactId>
            <version>3.0.1</version>
        </dependency>
    </dependencies>

    <build>
        <resources>
            <resource>
                <directory>src/main/resources</directory>
                <filtering>true</filtering>
            </resource>
        </resources>
        <plugins>
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>build-helper-maven-plugin</artifactId>
                <version>3.4.0</version>
                <executions>
                    <execution>
                        <id>timestamp-property</id>
                        <goals>
                            <goal>timestamp-property</goal>
                        </goals>
                        <configuration>
                            <name>build.time</name>
                            <pattern>yyyy-MM-dd HH:mm:ss</pattern>
                            <locale>en_US</locale>
                            <timeZone>GMT+8</timeZone>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-shade-plugin</artifactId>
                <version>3.5.0</version>
                <executions>
                    <execution>
                        <phase>package</phase>
                        <goals>
                            <goal>shade</goal>
                        </goals>
                        <configuration>
                            <transformers>
                                <transformer
                                        implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
                                    <manifestEntries>
                                        <Main-Class>${main.verticle}</Main-Class>
                                    </manifestEntries>
                                </transformer>
                            </transformers>
                            <artifactSet/>
                            <outputFile>${project.build.directory}/${project.artifactId}-${version}-fat.jar
                            </outputFile>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <!-- ProGuard混淆插件 -->
            <plugin>
                <groupId>com.github.wvengen</groupId>
                <artifactId>proguard-maven-plugin</artifactId>
                <version>2.7.0</version>
                <executions>
                    <execution>
                        <phase>package</phase>
                        <goals>
                            <goal>proguard</goal>
                        </goals>
                    </execution>
                </executions>
                <configuration>
                    <proguardVersion>7.2.0</proguardVersion>
                    <injar>${project.build.finalName}-fat.jar</injar>
                    <outjar>${project.build.finalName}-pg.jar</outjar>
                    <obfuscate>true</obfuscate>
                    <!-- ProGuard基本配置 -->
                    <options>
                        <!-- 通用保留规则 -->
                        <option>-dontwarn</option>
                        <option>-dontoptimize</option>
                        <option>-dontshrink</option>
                        <option>-dontnote</option>
                        <option>-ignorewarnings</option>

                        <option>-keepattributes Exceptions,InnerClasses,Signature,Deprecated,
                            SourceFile,LineNumberTable, *Annotation*,EnclosingMethod
                        </option>

                        <!-- 保留主入口点 -->
                        <option>-keep public class ${main.verticle} { public static void main(java.lang.String[]); }</option>

                        # 保留所有常量字段
                        <option>-keepclassmembers class * {  public static final *; }</option>
                        <!-- <option>-keepnames interface ** { *; }</option>-->
                        <!-- 保留Serializable序列化的类不被混淆-->
                        <option>-keep class * implements java.io.Serializable { *; }</option>
                        <option>-keepclassmembers class com.ijiaodui.diff.config.** { public *; }</option>
                        <option>-keepclassmembers class ** {
                            public void set*(***);
                            public *** get*();
                            }</option>

                        <!-- 保留Vert.x框架关键组件 -->
                        <option>-keep class io.vertx.core.** { *; }</option>
                        <option>-keep class io.vertx.ext.web.** { *; }</option>
                        <option>-keep class io.netty.** { *; }</option>

                        <!-- 保留依赖库的公开API -->
                        <option>-keep class com.fasterxml.jackson.** { *; }</option>
                        <option>-keep class org.apache.logging.** { *; }</option>
                        <option>-keep class org.yaml.snakeyaml.** { *; }</option>

                        <!-- 保留反射使用的类 -->
                        <option>-keepattributes RuntimeVisibleAnnotations,Signature</option>
                        <option>-keepclassmembers class * { @io.vertx.codegen.annotations.* *; }</option>

                        <!-- 保留资源文件 -->
                        <option>-keepclassmembers class * { public static ** getResourceAsStream(java.lang.String); }</option>
                        <option>-keepclassmembers class *.*ResourceBundle { *; }</option>

                        <!-- 添加Log4j2保留规则 -->
                        <option>-keep class org.apache.logging.log4j.** { *; }</option>
                        <option>-keepattributes *Annotation*, Signature, RuntimeVisibleAnnotations</option>
                        <option>-keepclassmembers class * {
                            @org.apache.logging.log4j.core.config.plugins.* *;
                            }</option>

                        <!-- 保留资源文件 -->
                        <option>-keepclassmembers class * {
                            public static ** getResourceAsStream(java.lang.String);
                            }</option>
                        <option>-keep class **.log4j2.xml</option>
                        <option>-keep class **.log4j2.properties</option>

                        <option>-dontwarn com.alibaba.**</option>
                        <option>-keep class com.alibaba.** { *;}</option>

                        <!--处理alibaba canal中依赖关系-->
                        <option>-dontwarn org.I0Itec.**</option>
                        <option>-keep class org.I0Itec.** { *;}</option>

                        <option>-dontwarn ch.qos..**</option>
                        <option>-keep class ch.qos..** { *;}</option>

                        <option>-dontwarn com.github.**</option>
                        <option>-keep class com.github.** { *;}</option>

                        <option>-dontwarn com.google.**</option>
                        <option>-keep class com.google.** { *;}</option>

                        <option>-dontwarn com.hazelcast.**</option>
                        <option>-keep class com.hazelcast.** { *;}</option>

                        <option>-dontwarn com.fasterxml.**</option>
                        <option>-keep class com.fasterxml.** { *;}</option>

                        <option>-dontwarn com.networknt</option>
                        <option>-keep class com.networknt.** { *;}</option>

                        <option>-dontwarn com.sun.**</option>
                        <option>-keep class com.sun.** { *;}</option>

                        <option>-dontwarn com.mchange.**</option>
                        <option>-keep class com.mchange.** { *;}</option>

                        <option>-dontwarn com.microsoft.**</option>
                        <option>-keep class com.microsoft.** { *;}</option>

                        <option>-dontwarn com.thoughtworks.**</option>
                        <option>-keep class com.thoughtworks.** { *;}</option>

                        <option>-dontwarn groovy.**</option>
                        <option>-keep class groovy.** { *;}</option>

                        <option>-dontwarn io.exemplars.**</option>
                        <option>-keep class io.exemplars.** { *;}</option>

                        <option>-dontwarn io.minio.**</option>
                        <option>-keep class io.minio.** { *;}</option>

                        <option>-dontwarn io.vertx.**</option>
                        <option>-keep class io.vertx.** { *;}</option>

                        <option>-dontwarn io.netty.**</option>
                        <option>-keep class io.netty.** { *;}</option>

                        <option>-dontwarn io.micrometer.**</option>
                        <option>-keep class io.micrometer.** { *;}</option>

                        <option>-dontwarn io.opentelemetry.**</option>
                        <option>-keep class io.opentelemetry.** { *;}</option>

                        <option>-dontwarn io.prometheus.**</option>
                        <option>-keep class io.prometheus.** { *;}</option>

                        <option>-dontwarn javax.**</option>
                        <option>-keep class javax.** { *;}</option>

                        <option>-dontwarn lombok.**</option>
                        <option>-keep class lombok.** { *;}</option>

                        <option>-dontwarn net.arnx.**</option>
                        <option>-keep class net.arnx.** { *;}</option>

                        <option>-dontwarn org.apache.**</option>
                        <option>-keep class org.apache.** { *;}</option>

                        <option>-dontwarn org.docx4j.**</option>
                        <option>-keep class org.docx4j.** { *;}</option>

                        <option>-dontwarn org.codehaus.**</option>
                        <option>-keep class org.codehaus.** { *;}</option>

                        <option>-dontwarn org.dom4j.**</option>
                        <option>-keep class org.dom4j.** { *;}</option>

                        <option>-dontwarn org.etsi.**</option>
                        <option>-keep class org.etsi.** { *;}</option>

                        <option>-dontwarn org.jboss.**</option>
                        <option>-keep class org.jboss.** { *;}</option>

                        <option>-dontwarn org.opendope.**</option>
                        <option>-keep class org.opendope.** { *;}</option>

                        <option>-dontwarn org.openxmlformats.**</option>
                        <option>-keep class org.openxmlformats.** { *;}</option>

                        <option>-dontwarn org.plutext.**</option>
                        <option>-keep class org.plutext.** { *;}</option>

                        <option>-dontwarn org.pptx4j.**</option>
                        <option>-keep class org.pptx4j.** { *;}</option>

                        <option>-dontwarn org.slf4j.**</option>
                        <option>-keep class org.slf4j.** { *;}</option>
                        <option>-keepclassmembers class * {  private static final org.slf4j.Logger *; }</option>

                        <option>-dontwarn org.springframework.**</option>
                        <option>-keep class org.springframework.** { *;}</option>

                        <option>-dontwarn org.w3.**</option>
                        <option>-keep class org.w3.** { *;}</option>

                        <option>-dontwarn org.w3c.**</option>
                        <option>-keep class org.w3c.** { *;}</option>

                        <option>-dontwarn org.xlsx4j.**</option>
                        <option>-keep class org.xlsx4j.** { *;}</option>

                        <option>-dontwarn org.xml.**</option>
                        <option>-keep class org.xml.** { *;}</option>

                        <option>-dontwarn org.yaml.**</option>
                        <option>-keep class org.yaml.** { *;}</option>

                        <option>-dontwarn sun.**</option>
                        <option>-keep class sun.** { *;}</option>

                        # 保留数据库驱动相关类
                        # ========== MySQL驱动保护规则 ==========
                        # 保护整个MySQL Connector/J包
                        <option>-keep class com.mysql.cj.** { *; }</option>
                        <option>-keep class com.mysql.** { *; }</option>

                        # 保护所有MySQL JDBC接口和实现类
                        <option>-keep class * implements com.mysql.cj.jdbc.JdbcConnection { *; }</option>
                        <option>-keep class * implements com.mysql.cj.protocol.Protocol { *; }</option>
                        <option>-keep class * implements com.mysql.cj.conf.ConnectionUrl { *; }</option>

                        # 保护特定的关键类（根据错误信息）
                        <option>-keep class com.mysql.cj.conf.url.SingleConnectionUrl { *; }</option>
                        <option>-keep class com.mysql.cj.conf.url.** { *; }</option>

                        # 保护所有URL解析相关的类
                        <option>-keep class com.mysql.cj.conf.** { *; }</option>

                        # 保护异常类
                        <option>-keep class com.mysql.cj.exceptions.** { *; }</option>

                        # 保护协议相关类
                        <option>-keep class com.mysql.cj.protocol.** { *; }</option>

                        # 保护结果集和语句相关类
                        <option>-keep class com.mysql.cj.jdbc.** { *; }</option>

                    </options>
                    <!-- 依赖库路径 -->
                    <libs>
                        <!-- Include main JAVA library required.-->
                        <lib>${java.home}/jmods</lib>
                    </libs>
                </configuration>
                <dependencies>
                    <dependency>
                        <groupId>com.guardsquare</groupId>
                        <artifactId>proguard-base</artifactId>
                        <version>7.2.0</version>
                        <scope>runtime</scope>
                    </dependency>
                </dependencies>
            </plugin>
        </plugins>
    </build>

</project>
